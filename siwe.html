<!DOCTYPE html>
<html>
<head>
  <title>Wallet Connection</title>
</head>
<body>
  <button id="siwe">Connect Wallet</button>
  <div id="siweResult"></div>

  <script>
    const siweSign = async (siweMessage) => {
      try {
        // Ensure that MetaMask is installed and accessible
        if (typeof ethereum !== 'undefined') {
          // Request access to the user's Ethereum accounts
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });

          if (accounts.length === 0) {
            throw new Error('No Ethereum accounts found');
          }

          // Get the selected Ethereum address
          const from = accounts[0];
          const msg = `0x${Buffer.from(siweMessage, 'utf8').toString('hex')}`;

          // Sign the message
          const sign = await ethereum.request({
            method: 'personal_sign',
            params: [msg, from],
          });

          // Display the signature
          document.getElementById('siweResult').innerHTML = sign;
        } else {
          throw new Error('MetaMask is not installed.');
        }
      } catch (err) {
        console.error(err);
        document.getElementById('siweResult').innerHTML = `Error: ${err.message}`;
      }
    };

    document.getElementById('siwe').onclick = async () => {
      const domain = window.location.host;
      siweSign(`${domain} wants you to sign in with your Ethereum account:\n\nI accept the MetaMask Terms of Service: https://community.metamask.io/tos\n\nURI: https://${domain}\nVersion: 1\nChain ID: 1\nNonce: 32891757\nIssued At: 2021-09-30T16:25:24.000Z`);
    };
  </script>
</body>
</html>
