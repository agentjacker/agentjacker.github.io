<!DOCTYPE html>
<html>
<head>
  <title>Wallet Connection</title>
</head>
<body>
  <button id="siwe">Connect Wallet</button>
  <div id="siweResult"></div>

  <script>
    const siweSign = async (siweMessage) => {
      try {
        // Check if MetaMask is installed
        if (typeof window.ethereum !== 'undefined') {
          // Request account access from the user
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });

          // Get the selected Ethereum address
          const from = accounts[0];

          // Convert the message to a hex string
          const msg = `0x${Buffer.from(siweMessage, 'utf8').toString('hex')}`;

          // Sign the message
          const sign = await ethereum.request({
            method: 'personal_sign',
            params: [msg, from],
          });

          // Display the signature
          siweResult.innerHTML = sign;
        } else {
          siweResult.innerHTML = 'MetaMask is not installed.';
        }
      } catch (err) {
        console.error(err);
        siweResult.innerHTML = `Error: ${err.message}`;
      }
    };

    const siwe = document.getElementById('siwe');
    const siweResult = document.getElementById('siweResult');

    siwe.onclick = async () => {
      const domain = window.location.host;
      try {
        // Check if MetaMask is installed
        if (typeof window.ethereum !== 'undefined') {
          // Request account access from the user
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });

          // Get the selected Ethereum address
          const from = accounts[0];

          // Create the siweMessage
          const siweMessage = `${domain} wants you to sign in with your Ethereum account:\n${from}\n\nI accept the MetaMask Terms of Service: https://community.metamask.io/tos\n\nURI: https://${domain}\nVersion: 1\nChain ID: 1\nNonce: 32891757\nIssued At: 2021-09-30T16:25:24.000Z`;

          // Call the siweSign function
          siweSign(siweMessage);
        } else {
          siweResult.innerHTML = 'MetaMask is not installed.';
        }
      } catch (err) {
        console.error(err);
        siweResult.innerHTML = `Error: ${err.message}`;
      }
    };
  </script>
</body>
</html>
